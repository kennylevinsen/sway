image: archlinux
packages:
  - cairo
  - gdk-pixbuf2
  - json-c
  - libegl
  - libinput
  - libxcb
  - libxkbcommon
  - meson
  - pango
  - scdoc
  - wayland
  - wayland-protocols
  - xcb-util-image
  - xcb-util-wm
  - xorg-xwayland
  - seatd
sources:
  - https://github.com/swaywm/sway
  - https://github.com/swaywm/wlroots
tasks:
  - wlroots: |
      cd wlroots
      meson --prefix=/usr build -Dexamples=false
      ninja -C build
      sudo ninja -C build install
  - setup: |
      cd sway
      meson build --fatal-meson-warnings -Dauto_features=enabled -Dsd-bus-provider=libsystemd
  - build: |
      cd sway
      ninja -C build
  - smoke-test: |
      cd sway
      sudo modprobe vkms
      udevadm settle
      export WLR_BACKENDS=drm
      export WLR_RENDERER=pixman
      export WLR_DRM_DEVICES=/dev/dri/by-path/platform-vkms-card
      sudo chmod ugo+rw /dev/dri/by-path/platform-vkms-card
      echo -e "exec echo hello\nexec ./build/swaymsg//swaymsg exit\n" > test.config
      sudo chmod a+s $(which seatd-launch)
      seatd-launch -- ./build/sway/sway -c test.config -d
